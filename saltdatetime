import moment from "moment-timezone";

const FMT = "YYYY-MM-DD";

/** Latest closed month end as of now (UTC-safe). */
export const latestClosedMonthEndISO = (): string => {
  const today = moment.utc();
  const endThisMonth = today.clone().endOf("month");
  if (today.isBefore(endThisMonth, "day")) {
    return today.clone().subtract(1, "month").endOf("month").format(FMT);
  }
  return endThisMonth.format(FMT);
};

/** Given any month-end (ISO), return the previous quarter's close. */
export const previousQuarterEndFromISO = (iso: string): string => {
  return moment.utc(iso, FMT).subtract(1, "quarter").endOf("quarter").format(FMT);
};
