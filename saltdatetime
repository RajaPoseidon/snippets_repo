import { format, endOfQuarter, subQuarters } from "date-fns";

const FMT = "yyyy-MM-dd";

export const latestClosedQuarterISO = (): string => {
  const now = new Date();             // JS Date with local TZ, but we'll only read Y/M/D
  const endThisQ = endOfQuarter(now);
  if (now < endThisQ) {
    return format(endOfQuarter(subQuarters(now, 1)), FMT);
  }
  return format(endThisQ, FMT);
};

export const previousQuarterFromISO = (iso: string): string => {
  const d = new Date(iso + "T00:00:00Z"); // force UTC midnight
  return format(endOfQuarter(subQuarters(d, 1)), FMT);
};